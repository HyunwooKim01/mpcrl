📝 Logging to logs/mpc_20251031_192904.log
🚀 Real-world MPC (CasADi) starting...
✅ MQTT connected → 172.27.148.207:1883
🟢 MQTT connected successfully, subscribed to {'sensor': 'farmA/esp1/sensor', 'disturbance': 'farmA/esp1/disturbance', 'actuator_control': 'farmA/esp1/actuator/control'}
📡 Subscribed topics: {'sensor': 'farmA/esp1/sensor', 'disturbance': 'farmA/esp1/disturbance', 'actuator_control': 'farmA/esp1/actuator/control'}
-------------------------------------------
This is casadi::QRQP
Number of variables:                             244
Number of constraints:                           172
Number of nonzeros in H:                         832
Number of nonzeros in A:                         529
Number of nonzeros in KKT:                      2062
Number of nonzeros in QR(V):                    3055
Number of nonzeros in QR(R):                    5799
🎯 Target → T_ref=20.0°C, H_ref=60.0%
✅ MPC loop running...

 Iter  Sing        fk      |pr|   con      |du|   var     min_R   con  last_tau  Note
    0     0         0       4.2   250   3.6e+02     1     0.047   257         0  
    1     0  -1.5e+06   1.1e-09   300   1.5e-09   123     0.047   257         1  Converged
 Iter  Sing        fk      |pr|   con      |du|   var     min_R   con  last_tau  Note
    0     0         0   1.1e-09   300        37    93     0.047   257         0  
    1     0  -4.3e+03   4.4e-12   286   9.9e-12   147     0.047   257         1  Converged
 Iter  Sing        fk      |pr|   con      |du|   var     min_R   con  last_tau  Note
    0     0         0   4.3e-12   286      0.79     9     0.047   257         0  
    1     0    -0.031   1.5e-13   258   2.9e-13     2     0.047   257         1  Converged
 Iter  Sing        fk      |pr|   con      |du|   var     min_R   con  last_tau  Note
    0     0         0   1.7e-13   258     3e-06     8     0.047   257         0  
    1     0  -2.2e-12     9e-15   345   2.9e-13     2     0.047   257         1  Converged
MESSAGE(sqpmethod): Convergence achieved after 4 iterations
⚙️ u=[0.    0.    0.167]
📤 Sent actuator command → {'fan': 0.0, 'heater': 0.0, 'led': 0.16666661802950258, 'timestamp': 1761906546.522941}

────────────────────────────────────────────
⏱ [STEP 001] t=1761906546.49 (Δt=5.0s)
🌡 Temp=0.0°C  💧Hum=0.0%  ☁️CO₂=0ppm  💡Light=0.0lx
🌞 Rad=0W/m²  🌬OutT=15.0°C  💧OutH=50%
⚙️ u_opt → FAN=0.00 | HEATER=0.00 | LED=0.17
────────────────────────────────────────────
 Iter  Sing        fk      |pr|   con      |du|   var     min_R   con  last_tau  Note
    0     0         0      0.17   254   3.6e+02     1     0.047   257         0  
    1     0   -0.0028     1e-09   300   2.6e-09   105     0.047   257         1  Converged
MESSAGE(sqpmethod): Convergence achieved after 1 iterations
⚙️ u=[0.    0.    0.167]
📤 Sent actuator command → {'fan': 0.0, 'heater': 0.0, 'led': 0.16666662831754955, 'timestamp': 1761906551.5473578}

────────────────────────────────────────────
⏱ [STEP 002] t=1761906551.53 (Δt=5.0s)
🌡 Temp=0.0°C  💧Hum=0.0%  ☁️CO₂=0ppm  💡Light=0.0lx
🌞 Rad=0W/m²  🌬OutT=15.0°C  💧OutH=50%
⚙️ u_opt → FAN=0.00 | HEATER=0.00 | LED=0.17
────────────────────────────────────────────
[WARN] Sensor payload stale (> timeout).
[WARN] Disturbance payload stale (> timeout).
 Iter  Sing        fk      |pr|   con      |du|   var     min_R   con  last_tau  Note
    0     0         0     1e-08   254   3.6e+02     1     0.047   257         0  
    1     0  -2.3e-09     1e-09   258   9.2e-10   135     0.047   257         1  Converged
MESSAGE(sqpmethod): Convergence achieved after 1 iterations
⚙️ u=[0.    0.    0.167]
📤 Sent actuator command → {'fan': 0.0, 'heater': 0.0, 'led': 0.16666662831757076, 'timestamp': 1761906556.5719337}

────────────────────────────────────────────
⏱ [STEP 003] t=1761906556.55 (Δt=5.0s)
🌡 Temp=0.0°C  💧Hum=0.0%  ☁️CO₂=0ppm  💡Light=0.0lx
🌞 Rad=0W/m²  🌬OutT=15.0°C  💧OutH=50%
⚙️ u_opt → FAN=0.00 | HEATER=0.00 | LED=0.17
────────────────────────────────────────────
[WARN] Sensor payload stale (> timeout).
[WARN] Disturbance payload stale (> timeout).
[WARN] Sensor payload stale (> timeout).
[WARN] Disturbance payload stale (> timeout).
 Iter  Sing        fk      |pr|   con      |du|   var     min_R   con  last_tau  Note
    0     0         0     1e-09   258   3.6e+02     1     0.047   257         0  
    1     0  -9.4e-10   1.5e-09   286   9.4e-10   102     0.047   257         1  Converged
MESSAGE(sqpmethod): Search direction becomes too small without convergence criteria being met.
⚙️ u=[0.    0.    0.167]
📤 Sent actuator command → {'fan': 0.0, 'heater': 0.0, 'led': 0.1666666283175578, 'timestamp': 1761906561.5859332}

────────────────────────────────────────────
⏱ [STEP 004] t=1761906561.58 (Δt=5.0s)
🌡 Temp=0.0°C  💧Hum=0.0%  ☁️CO₂=0ppm  💡Light=0.0lx
🌞 Rad=0W/m²  🌬OutT=15.0°C  💧OutH=50%
⚙️ u_opt → FAN=0.00 | HEATER=0.00 | LED=0.17
────────────────────────────────────────────
[WARN] Sensor payload stale (> timeout).
[WARN] Disturbance payload stale (> timeout).
[WARN] Sensor payload stale (> timeout).
[WARN] Disturbance payload stale (> timeout).
 Iter  Sing        fk      |pr|   con      |du|   var     min_R   con  last_tau  Note
    0     0         0   1.2e-09   286   3.6e+02     1     0.047   257         0  
    1     0   3.1e-10   1.1e-09   286   8.7e-10   129     0.047   257         1  Converged
MESSAGE(sqpmethod): Search direction becomes too small without convergence criteria being met.
⚙️ u=[0.    0.    0.167]
📤 Sent actuator command → {'fan': 0.0, 'heater': 0.0, 'led': 0.1666666283175578, 'timestamp': 1761906566.6093915}

────────────────────────────────────────────
⏱ [STEP 005] t=1761906566.59 (Δt=5.0s)
🌡 Temp=0.0°C  💧Hum=0.0%  ☁️CO₂=0ppm  💡Light=0.0lx
🌞 Rad=0W/m²  🌬OutT=15.0°C  💧OutH=50%
⚙️ u_opt → FAN=0.00 | HEATER=0.00 | LED=0.17
────────────────────────────────────────────
[WARN] Sensor payload stale (> timeout).
[WARN] Disturbance payload stale (> timeout).
📩 MQTT farmA/esp1/sensor : {'temp_in': 16.2, 'hum_in': 77.0, 'co2_in': 440.0, 'light_in': 16.0, 'timestamp': 1761906573.9773543}
📩 MQTT farmA/esp1/disturbance : {'solar_rad': 20, 'co2_out': 420, 'temp_out': 14.2, 'hum_out': 82, 'timestamp': 1761906573.9773495}
 Iter  Sing        fk      |pr|   con      |du|   var     min_R   con  last_tau  Note
    0     0         0   4.4e+02   246   3.6e+02     1     0.047   257         0  
    1     0    -7e+05   7.1e-11   405   1.5e-10   105     0.047   257         1  Converged
 Iter  Sing        fk      |pr|   con      |du|   var     min_R   con  last_tau  Note
    0     0         0   7.1e-11   405   2.2e+02     1     0.047   257         0  
    1     0  -8.2e+02   1.5e-12   251   2.2e-11   102     0.047   257         1  Converged
 Iter  Sing        fk      |pr|   con      |du|   var     min_R   con  last_tau  Note
    0     0         0   1.4e-12   251    0.0019     8     0.047   257         0  
    1     0  -5.9e-07   1.3e-11   377   2.7e-14    14     0.047   257         1  Converged
MESSAGE(sqpmethod): Convergence achieved after 3 iterations
⚙️ u=[1.    1.    0.152]
📤 Sent actuator command → {'fan': 1.0, 'heater': 1.0, 'led': 0.15166663355816654, 'timestamp': 1761906571.6580741}

────────────────────────────────────────────
⏱ [STEP 006] t=1761906571.61 (Δt=5.0s)
🌡 Temp=16.2°C  💧Hum=77.0%  ☁️CO₂=440ppm  💡Light=16.0lx
🌞 Rad=20W/m²  🌬OutT=14.2°C  💧OutH=82%
⚙️ u_opt → FAN=1.00 | HEATER=1.00 | LED=0.15
────────────────────────────────────────────
📩 MQTT farmA/esp1/sensor : {'temp_in': 16.1, 'hum_in': 78.0, 'co2_in': 441.0, 'light_in': 14.4, 'timestamp': 1761906579.0201995}
📩 MQTT farmA/esp1/disturbance : {'solar_rad': 18, 'co2_out': 421, 'temp_out': 14.1, 'hum_out': 83, 'timestamp': 1761906579.0201893}
 Iter  Sing        fk      |pr|   con      |du|   var     min_R   con  last_tau  Note
    0     0         0       1.6   247   2.8e+02     3     0.047   257         0  
    1     0   7.8e+02   6.5e-11   258   1.3e-10   102     0.047   257         1  Converged
 Iter  Sing        fk      |pr|   con      |du|   var     min_R   con  last_tau  Note
    0     0         0   6.5e-11   258   3.1e-05    12     0.047   257         0  
    1     0    -2e-10   1.3e-11   321     2e-14     3     0.047   257         1  Converged
MESSAGE(sqpmethod): Convergence achieved after 2 iterations
⚙️ u=[1.    1.    0.153]
📤 Sent actuator command → {'fan': 1.0, 'heater': 1.0, 'led': 0.15316663187503077, 'timestamp': 1761906576.6762946}

────────────────────────────────────────────
⏱ [STEP 007] t=1761906576.66 (Δt=5.0s)
🌡 Temp=16.1°C  💧Hum=78.0%  ☁️CO₂=441ppm  💡Light=14.4lx
🌞 Rad=18W/m²  🌬OutT=14.1°C  💧OutH=83%
⚙️ u_opt → FAN=1.00 | HEATER=1.00 | LED=0.15
────────────────────────────────────────────
📩 MQTT farmA/esp1/sensor : {'temp_in': 15.9, 'hum_in': 79.0, 'co2_in': 442.0, 'light_in': 12.8, 'timestamp': 1761906584.0265968}
📩 MQTT farmA/esp1/disturbance : {'solar_rad': 16, 'co2_out': 422, 'temp_out': 13.9, 'hum_out': 84, 'timestamp': 1761906584.0265834}
 Iter  Sing        fk      |pr|   con      |du|   var     min_R   con  last_tau  Note
    0     0         0       1.6   247   2.9e+02     3     0.047   257         0  
    1     0   8.1e+02   8.6e-11   272   5.4e-11   117     0.047   257         1  Converged
 Iter  Sing        fk      |pr|   con      |du|   var     min_R   con  last_tau  Note
    0     0         0   8.6e-11   272   3.9e-05     4     0.047   257         0  
    1     0  -3.4e-10   8.8e-12   321   3.7e-14    22     0.047   257         1  Converged
MESSAGE(sqpmethod): Convergence achieved after 2 iterations
⚙️ u=[1.    1.    0.155]
📤 Sent actuator command → {'fan': 1.0, 'heater': 1.0, 'led': 0.1546666312169277, 'timestamp': 1761906581.6927524}

────────────────────────────────────────────
⏱ [STEP 008] t=1761906581.68 (Δt=5.0s)
🌡 Temp=15.9°C  💧Hum=79.0%  ☁️CO₂=442ppm  💡Light=12.8lx
🌞 Rad=16W/m²  🌬OutT=13.9°C  💧OutH=84%
⚙️ u_opt → FAN=1.00 | HEATER=1.00 | LED=0.15
────────────────────────────────────────────
📩 MQTT farmA/esp1/sensor : {'temp_in': 15.8, 'hum_in': 79.0, 'co2_in': 443.0, 'light_in': 12.0, 'timestamp': 1761906589.0327103}
📩 MQTT farmA/esp1/disturbance : {'solar_rad': 15, 'co2_out': 423, 'temp_out': 13.8, 'hum_out': 84, 'timestamp': 1761906589.0326965}
 Iter  Sing        fk      |pr|   con      |du|   var     min_R   con  last_tau  Note
    0     0         0         1   246   2.9e+02     3     0.047   257         0  
    1     0   4.4e+02   1.1e-10   258   7.8e-11   129     0.047   257         1  Converged
MESSAGE(sqpmethod): Convergence achieved after 1 iterations
⚙️ u=[1.    1.    0.155]
📤 Sent actuator command → {'fan': 1.0, 'heater': 1.0, 'led': 0.1554166311075481, 'timestamp': 1761906586.7043798}

────────────────────────────────────────────
⏱ [STEP 009] t=1761906586.69 (Δt=5.0s)
🌡 Temp=15.8°C  💧Hum=79.0%  ☁️CO₂=443ppm  💡Light=12.0lx
🌞 Rad=15W/m²  🌬OutT=13.8°C  💧OutH=84%
⚙️ u_opt → FAN=1.00 | HEATER=1.00 | LED=0.16
────────────────────────────────────────────
📩 MQTT farmA/esp1/sensor : {'temp_in': 15.7, 'hum_in': 80.0, 'co2_in': 444.0, 'light_in': 12.0, 'timestamp': 1761906594.069209}
📩 MQTT farmA/esp1/disturbance : {'solar_rad': 15, 'co2_out': 424, 'temp_out': 13.7, 'hum_out': 85, 'timestamp': 1761906594.069191}
 Iter  Sing        fk      |pr|   con      |du|   var     min_R   con  last_tau  Note
    0     0         0         1   245   2.9e+02     3     0.047   257         0  
    1     0   3.7e+02   8.1e-11   272   8.3e-11   117     0.047   257         1  Converged
 Iter  Sing        fk      |pr|   con      |du|   var     min_R   con  last_tau  Note
    0     0         0   8.1e-11   272   3.5e-05    12     0.047   257         0  
    1     0  -2.6e-10   4.9e-15   412   2.4e-14    34     0.047   257         1  Converged
MESSAGE(sqpmethod): Convergence achieved after 2 iterations
⚙️ u=[1.    1.    0.155]
📤 Sent actuator command → {'fan': 1.0, 'heater': 1.0, 'led': 0.15541663085944923, 'timestamp': 1761906591.7206275}

────────────────────────────────────────────
⏱ [STEP 010] t=1761906591.71 (Δt=5.0s)
🌡 Temp=15.7°C  💧Hum=80.0%  ☁️CO₂=444ppm  💡Light=12.0lx
🌞 Rad=15W/m²  🌬OutT=13.7°C  💧OutH=85%
⚙️ u_opt → FAN=1.00 | HEATER=1.00 | LED=0.16
────────────────────────────────────────────
📩 MQTT farmA/esp1/sensor : {'temp_in': 15.6, 'hum_in': 80.0, 'co2_in': 444.0, 'light_in': 12.0, 'timestamp': 1761906599.076948}
📩 MQTT farmA/esp1/disturbance : {'solar_rad': 15, 'co2_out': 424, 'temp_out': 13.6, 'hum_out': 85, 'timestamp': 1761906599.0769336}
 Iter  Sing        fk      |pr|   con      |du|   var     min_R   con  last_tau  Note
    0     0         0       0.1   244   2.9e+02     3     0.047   257         0  
    1     0       9.5   8.4e-11   258   8.7e-11   102     0.047   257         1  Converged
MESSAGE(sqpmethod): Convergence achieved after 1 iterations
⚙️ u=[1.    1.    0.155]
📤 Sent actuator command → {'fan': 1.0, 'heater': 1.0, 'led': 0.15541663082974788, 'timestamp': 1761906596.7320588}

────────────────────────────────────────────
⏱ [STEP 011] t=1761906596.72 (Δt=5.0s)
🌡 Temp=15.6°C  💧Hum=80.0%  ☁️CO₂=444ppm  💡Light=12.0lx
🌞 Rad=15W/m²  🌬OutT=13.6°C  💧OutH=85%
⚙️ u_opt → FAN=1.00 | HEATER=1.00 | LED=0.16
────────────────────────────────────────────
